appId: ${APP_ID}
name: MFA Login Flow
tags:
  - auth
  - mfa
  - security
---
# MFA Login Test
# Tests login with MFA verification required

- launchApp:
    clearState: true

# Wait for app to load
- waitForAnimationToEnd

# Enter credentials
- tapOn:
    text: "Email"
- inputText: "mfa-user@example.com"
- tapOn:
    text: "Password"
- inputText: "password123"

# Submit login
- tapOn:
    text: "Sign In"
    index: 1
- waitForAnimationToEnd:
    timeout: 5000

# Verify MFA screen appears
- assertVisible:
    text:
      - "verification"
      - "code"
      - "2FA"
      - "authenticator"
    optional: true

# Enter MFA code
- tapOn:
    id: "mfa-input"
    optional: true
- inputText: "123456"

# Or enter in OTP input fields
- tapOn:
    id: "otp-input-0"
    optional: true
- inputText: "1"
- tapOn:
    id: "otp-input-1"
    optional: true
- inputText: "2"
- tapOn:
    id: "otp-input-2"
    optional: true
- inputText: "3"
- tapOn:
    id: "otp-input-3"
    optional: true
- inputText: "4"
- tapOn:
    id: "otp-input-4"
    optional: true
- inputText: "5"
- tapOn:
    id: "otp-input-5"
    optional: true
- inputText: "6"

# Submit MFA code
- tapOn:
    text: "Verify"
    optional: true
- waitForAnimationToEnd:
    timeout: 5000

# Verify successful login
- assertVisible:
    text:
      - "Home"
      - "Welcome"
      - "Dashboard"
    optional: true

# Test backup code flow
- runFlow:
    when:
      visible: "Use backup code"
    file: mfa-backup-code.yaml
